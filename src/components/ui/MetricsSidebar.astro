---
import { metrics, getAllMetricCategories } from '../../lib/data';
import { getCategoryTextColor, getTierDotColor } from '../../lib/metrics-colors';
import { url } from '../../lib/url';

interface Props {
  currentSlug?: string;
}

const { currentSlug } = Astro.props;

const categories = getAllMetricCategories();
const metricsByCategory = categories.map(cat => ({
  category: cat,
  metrics: metrics.filter(m => m.category === cat && m.tier !== 'inferior' && m.tier !== 'activity'),
})).filter(g => g.metrics.length > 0);
---

<aside class="hidden lg:block w-64 shrink-0 sticky top-20 self-start max-h-[calc(100vh-6rem)] overflow-y-auto">
  <nav class="space-y-4 pr-4">
    <a href={url("/metrics/")} class:list={[
      'block text-sm font-semibold mb-4 transition-colors',
      !currentSlug
        ? 'text-blue-600 dark:text-blue-400'
        : 'text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white',
    ]}>
      All Metrics
    </a>
    {metricsByCategory.map(({ category, metrics: catMetrics }) => (
      <div>
        <h4 class:list={['text-xs font-semibold uppercase tracking-wider mb-1.5', getCategoryTextColor(category)]}>
          {category}
        </h4>
        <ul class="space-y-0.5">
          {catMetrics.map(m => (
            <li>
              <a
                href={url(`/metrics/${m.slug}/`)}
                class:list={[
                  'flex items-center gap-2 text-sm py-1 px-2 rounded-md transition-colors',
                  m.slug === currentSlug
                    ? 'bg-blue-50 text-blue-700 font-medium dark:bg-blue-900/30 dark:text-blue-300'
                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-800',
                ]}
                aria-current={m.slug === currentSlug ? 'page' : undefined}
              >
                <span class:list={['w-1.5 h-1.5 rounded-full shrink-0', getTierDotColor(m.tier)]}></span>
                <span class="truncate">{m.name}</span>
              </a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </nav>
</aside>

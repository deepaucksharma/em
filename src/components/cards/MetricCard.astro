---
import TierBadge from '../ui/TierBadge.astro';
import type { Metric } from '../../lib/data';
import { getCategoryColor } from '../../lib/metrics-colors';
import { url } from '../../lib/url';

interface Props {
  metric: Metric;
  compact?: boolean;
}

const { metric, compact = false } = Astro.props;

const categoryColor = getCategoryColor(metric.category);
const typeClass = `badge-type-${metric.type}`;
---

{compact ? (
  <a href={url(`/metrics/${metric.slug}/`)} class="flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700 bg-white dark:bg-gray-800 transition-colors group">
    <TierBadge tier={metric.tier} size="sm" />
    <span class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 truncate">{metric.name}</span>
    <span class:list={['badge text-[10px]', categoryColor]}>{metric.category}</span>
  </a>
) : (
  <a href={url(`/metrics/${metric.slug}/`)} class="card group block">
    <div class="flex items-center justify-between mb-2">
      <TierBadge tier={metric.tier} size="sm" />
      <span class="text-xs font-mono text-gray-400 dark:text-gray-500">{metric.id}</span>
    </div>
    <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 mb-1.5 transition-colors">
      {metric.name}
    </h3>
    <div class="flex items-center gap-2 mb-2 flex-wrap">
      <span class:list={['badge text-[10px]', categoryColor]}>{metric.category}</span>
      <span class:list={['badge text-[10px]', typeClass]}>{metric.type}</span>
      {metric.cadence !== 'never-as-kpi' && (
        <span class="text-[10px] text-gray-400 dark:text-gray-500">{metric.cadence}</span>
      )}
    </div>
    <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">{metric.description}</p>
    {metric.emRank.rank < 99 && (
      <div class="flex items-center gap-3 mt-3 pt-3 border-t border-gray-100 dark:border-gray-700/50 text-xs text-gray-500 dark:text-gray-400">
        <span>EM: <strong class="text-gray-700 dark:text-gray-300">{metric.emRank.priority}</strong></span>
        <span>Dir: <strong class="text-gray-700 dark:text-gray-300">{metric.directorRank.priority}</strong></span>
      </div>
    )}
  </a>
)}

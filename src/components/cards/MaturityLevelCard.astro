---
import { getCapability } from '../../lib/data';

interface Props {
  level: {
    level: number;
    name: string;
    slug: string;
    description: string;
    indicators: string[];
    recommendedActions: string[];
    capabilityFocus: string[];
  };
}

const { level } = Astro.props;

const levelColors: Record<number, { bg: string; border: string; text: string; dot: string }> = {
  1: { bg: 'bg-red-50 dark:bg-red-950/20', border: 'border-red-200 dark:border-red-800', text: 'text-red-700 dark:text-red-300', dot: 'bg-red-500' },
  2: { bg: 'bg-orange-50 dark:bg-orange-950/20', border: 'border-orange-200 dark:border-orange-800', text: 'text-orange-700 dark:text-orange-300', dot: 'bg-orange-500' },
  3: { bg: 'bg-yellow-50 dark:bg-yellow-950/20', border: 'border-yellow-200 dark:border-yellow-800', text: 'text-yellow-700 dark:text-yellow-300', dot: 'bg-yellow-500' },
  4: { bg: 'bg-blue-50 dark:bg-blue-950/20', border: 'border-blue-200 dark:border-blue-800', text: 'text-blue-700 dark:text-blue-300', dot: 'bg-blue-500' },
  5: { bg: 'bg-green-50 dark:bg-green-950/20', border: 'border-green-200 dark:border-green-800', text: 'text-green-700 dark:text-green-300', dot: 'bg-green-500' },
};

const colors = levelColors[level.level] || levelColors[1];
const focusCaps = level.capabilityFocus.map(id => getCapability(id)).filter(Boolean);
---

<div id={level.slug} class:list={['rounded-xl border p-6', colors.border, colors.bg]}>
  <div class="flex items-center gap-3 mb-3">
    <span class:list={['w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm', colors.dot]}>
      {level.level}
    </span>
    <h3 class:list={['text-lg font-bold', colors.text]}>{level.name}</h3>
  </div>

  <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">{level.description}</p>

  <div class="space-y-4">
    <div>
      <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Indicators</h4>
      <ul class="space-y-1">
        {level.indicators.map(indicator => (
          <li class="text-sm text-gray-600 dark:text-gray-400 flex items-start gap-2">
            <span class:list={['w-1.5 h-1.5 rounded-full mt-1.5 shrink-0', colors.dot]} />
            {indicator}
          </li>
        ))}
      </ul>
    </div>

    <div>
      <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Recommended Actions</h4>
      <ul class="space-y-1">
        {level.recommendedActions.map(action => (
          <li class="text-sm text-gray-600 dark:text-gray-400 flex items-start gap-2">
            <svg class="w-4 h-4 mt-0.5 shrink-0 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            {action}
          </li>
        ))}
      </ul>
    </div>

    {focusCaps.length > 0 && (
      <div>
        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Capability Focus</h4>
        <div class="flex flex-wrap gap-2">
          {focusCaps.map(cap => cap && (
            <a href={`/capabilities/${cap.slug}/`} class="text-xs px-2 py-1 rounded-full bg-white/60 dark:bg-gray-800/60 text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-700 transition-colors">
              {cap.id}: {cap.name}
            </a>
          ))}
        </div>
      </div>
    )}
  </div>
</div>

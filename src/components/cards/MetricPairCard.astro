---
import type { MetricPair } from '../../lib/data';
import { getMetric } from '../../lib/data';

interface Props {
  pair: MetricPair;
}

const { pair } = Astro.props;
const metricA = getMetric(pair.metricA.id);
const metricB = getMetric(pair.metricB.id);
const alsoMetricsA = (pair.metricA.alsoIds || []).map(id => getMetric(id)).filter(Boolean);
const alsoMetricsB = (pair.metricB.alsoIds || []).map(id => getMetric(id)).filter(Boolean);
---

<div class="rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-hidden">
  <div class="p-5">
    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-3">{pair.name}</h3>
    <div class="grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-4 items-center mb-4">
      <!-- Metric A -->
      <div class="rounded-lg border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20 p-4">
        <div class="text-xs font-medium text-blue-500 dark:text-blue-400 mb-1">{pair.metricA.role}</div>
        <a href={metricA ? `/metrics/${metricA.slug}/` : '#'} class="font-semibold text-blue-900 dark:text-blue-200 hover:text-blue-700 dark:hover:text-blue-100 transition-colors">
          {metricA?.name || pair.metricA.id}
        </a>
        <div class="text-xs text-blue-600 dark:text-blue-400 mt-1">{metricA?.id}</div>
        {alsoMetricsA.length > 0 && (
          <div class="mt-2 pt-2 border-t border-blue-200 dark:border-blue-800 flex flex-wrap gap-1.5">
            {alsoMetricsA.map(m => m && (
              <a href={`/metrics/${m.slug}/`} class="text-[11px] text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 bg-blue-100 dark:bg-blue-900/30 rounded px-1.5 py-0.5">
                {m.id}: {m.name}
              </a>
            ))}
          </div>
        )}
      </div>
      <!-- Connector -->
      <div class="hidden md:flex flex-col items-center gap-1">
        <svg class="w-8 h-8 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
        </svg>
        <span class="text-[10px] font-medium text-amber-600 dark:text-amber-400">PAIRED</span>
      </div>
      <!-- Metric B -->
      <div class="rounded-lg border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/20 p-4">
        <div class="text-xs font-medium text-green-500 dark:text-green-400 mb-1">{pair.metricB.role}</div>
        <a href={metricB ? `/metrics/${metricB.slug}/` : '#'} class="font-semibold text-green-900 dark:text-green-200 hover:text-green-700 dark:hover:text-green-100 transition-colors">
          {metricB?.name || pair.metricB.id}
        </a>
        <div class="text-xs text-green-600 dark:text-green-400 mt-1">{metricB?.id}</div>
        {alsoMetricsB.length > 0 && (
          <div class="mt-2 pt-2 border-t border-green-200 dark:border-green-800 flex flex-wrap gap-1.5">
            {alsoMetricsB.map(m => m && (
              <a href={`/metrics/${m.slug}/`} class="text-[11px] text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-200 bg-green-100 dark:bg-green-900/30 rounded px-1.5 py-0.5">
                {m.id}: {m.name}
              </a>
            ))}
          </div>
        )}
      </div>
    </div>
    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">{pair.whyPaired}</p>
  </div>
  <!-- Warning boxes -->
  <div class="grid grid-cols-1 md:grid-cols-2 border-t border-gray-200 dark:border-gray-700">
    <div class="p-4 bg-amber-50 dark:bg-amber-950/10 border-b md:border-b-0 md:border-r border-gray-200 dark:border-gray-700">
      <div class="text-xs font-semibold text-amber-700 dark:text-amber-400 mb-1">Without {metricA?.name || 'Metric A'}:</div>
      <p class="text-sm text-amber-800 dark:text-amber-300 italic">{pair.withoutA}</p>
    </div>
    <div class="p-4 bg-amber-50 dark:bg-amber-950/10">
      <div class="text-xs font-semibold text-amber-700 dark:text-amber-400 mb-1">Without {metricB?.name || 'Metric B'}:</div>
      <p class="text-sm text-amber-800 dark:text-amber-300 italic">{pair.withoutB}</p>
    </div>
  </div>
</div>

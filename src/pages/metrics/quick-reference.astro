---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import TierBadge from '../../components/ui/TierBadge.astro';
import { metrics, priorityStacks, techDebtEconomics, getMetric } from '../../lib/data';
import { url } from '../../lib/url';

const inferiorMetrics = metrics.filter(m => m.tier === 'inferior');
const activityMetrics = metrics.filter(m => m.tier === 'activity');

const emStack = priorityStacks.em;
const directorStack = priorityStacks.director;
const starterSequences = techDebtEconomics.starterSequences;
const decisionTest = techDebtEconomics.decisionTest;

const dashboardLabels: Record<string, string> = {
  main: 'Main',
  team: 'Team',
  'drill-down': 'Drill-down',
  qbr: 'QBR',
  planning: 'Planning',
};
---

<BaseLayout title="Metrics Quick Reference" description="Priority stacks, starter sequences, decision tests, and metric selection guidance.">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <Breadcrumb items={[
      { label: 'Metrics', href: url('/metrics/') },
      { label: 'Quick Reference' },
    ]} />

    <div class="mb-10">
      <h1 class="text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-3">
        Quick Reference
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        Priority stacks ranked 1-15 for each role, starter sequences for getting started, and the 5-question test for adding new metrics.
      </p>
    </div>

    <!-- Priority Stacks -->
    <section class="mb-16">
      <h2 class="section-heading">Priority Stacks by Role</h2>
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
        Ranked 1-15 for each role. Start at #1 and add metrics only when the previous ones are habitual and driving decisions.
      </p>

      <!-- Priority Code Legend -->
      <div class="rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-4 mb-6">
        <h3 class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Priority Codes</h3>
        <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs text-gray-600 dark:text-gray-400">
          <span><strong class="text-amber-700 dark:text-amber-300">T3</strong> — Top 3 (start here)</span>
          <span><strong class="text-blue-700 dark:text-blue-300">C</strong> — Core (add when T3 habitual)</span>
          <span><strong class="text-gray-700 dark:text-gray-300">D</strong> — Diagnostic (use when investigating)</span>
          <span><strong class="text-gray-500 dark:text-gray-400">M</strong> — Monitor (background awareness)</span>
          <span><strong class="text-gray-400 dark:text-gray-500">CTX</strong> — Context only (not a KPI)</span>
          <span><strong class="text-gray-400 dark:text-gray-500">N/A</strong> — Not applicable for this role</span>
        </div>
      </div>

      <div class="mb-4">
        <div class="flex gap-2" id="stack-tabs">
          <button class="stack-tab active px-4 py-2 rounded-lg text-sm font-medium bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300" data-tab="em">
            EM Stack
          </button>
          <button class="stack-tab px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800" data-tab="director">
            Director Stack
          </button>
        </div>
      </div>

      <!-- EM Stack Table -->
      <div id="stack-em" class="stack-panel overflow-x-auto">
        <table class="w-full text-sm border-collapse">
          <thead>
            <tr class="border-b border-gray-200 dark:border-gray-700">
              <th class="text-center py-3 px-3 font-semibold text-gray-500 dark:text-gray-400 w-12">#</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Metric</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Tier</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Dashboard</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Cadence</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Why This Rank</th>
            </tr>
          </thead>
          <tbody>
            {emStack.map((entry) => {
              const m = getMetric(entry.metricId);
              return (
                <tr class:list={['border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50', entry.rank <= 4 && 'bg-amber-50/50 dark:bg-amber-950/10']}>
                  <td class="py-2.5 px-3 text-center">
                    <span class:list={['inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold',
                      entry.rank <= 4 ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300' :
                      entry.rank <= 8 ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300' :
                      'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400'
                    ]}>
                      {entry.rank}
                    </span>
                  </td>
                  <td class="py-2.5 px-3">
                    {m ? (
                      <a href={url(`/metrics/${m.slug}/`)} class="font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400">
                        {m.name}
                      </a>
                    ) : (
                      <span class="text-gray-500">{entry.metricId}</span>
                    )}
                  </td>
                  <td class="py-2.5 px-3">
                    {m && <TierBadge tier={m.tier} size="sm" />}
                  </td>
                  <td class="py-2.5 px-3">
                    <span class="text-xs text-gray-500 dark:text-gray-400">{dashboardLabels[entry.dashboard] || entry.dashboard}</span>
                  </td>
                  <td class="py-2.5 px-3 text-xs text-gray-500 dark:text-gray-400">{entry.cadence}</td>
                  <td class="py-2.5 px-3 text-xs text-gray-600 dark:text-gray-400 max-w-xs">{entry.rationale}</td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>

      <!-- Director Stack Table -->
      <div id="stack-director" class="stack-panel hidden overflow-x-auto">
        <table class="w-full text-sm border-collapse">
          <thead>
            <tr class="border-b border-gray-200 dark:border-gray-700">
              <th class="text-center py-3 px-3 font-semibold text-gray-500 dark:text-gray-400 w-12">#</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Metric</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Tier</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Dashboard</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Cadence</th>
              <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Why This Rank</th>
            </tr>
          </thead>
          <tbody>
            {directorStack.map((entry) => {
              const m = getMetric(entry.metricId);
              return (
                <tr class:list={['border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50', entry.rank <= 4 && 'bg-amber-50/50 dark:bg-amber-950/10']}>
                  <td class="py-2.5 px-3 text-center">
                    <span class:list={['inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold',
                      entry.rank <= 4 ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300' :
                      entry.rank <= 8 ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300' :
                      'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400'
                    ]}>
                      {entry.rank}
                    </span>
                  </td>
                  <td class="py-2.5 px-3">
                    {m ? (
                      <a href={url(`/metrics/${m.slug}/`)} class="font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400">
                        {m.name}
                      </a>
                    ) : (
                      <span class="text-gray-500">{entry.metricId}</span>
                    )}
                  </td>
                  <td class="py-2.5 px-3">
                    {m && <TierBadge tier={m.tier} size="sm" />}
                  </td>
                  <td class="py-2.5 px-3">
                    <span class="text-xs text-gray-500 dark:text-gray-400">{dashboardLabels[entry.dashboard] || entry.dashboard}</span>
                  </td>
                  <td class="py-2.5 px-3 text-xs text-gray-500 dark:text-gray-400">{entry.cadence}</td>
                  <td class="py-2.5 px-3 text-xs text-gray-600 dark:text-gray-400 max-w-xs">{entry.rationale}</td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>
    </section>

    <!-- Daily Routines -->
    <section class="mb-16">
      <h2 class="section-heading">Daily & Monthly Routines</h2>
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
        Build metrics into your existing rhythm. Start with the weekly check, then build toward monthly reviews.
      </p>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="rounded-xl border border-cyan-200 dark:border-cyan-800 bg-cyan-50 dark:bg-cyan-950/20 p-5">
          <h3 class="text-sm font-bold text-cyan-700 dark:text-cyan-300 uppercase tracking-wider mb-4">EM Monday Routine</h3>
          <p class="text-xs text-cyan-600 dark:text-cyan-400 mb-3">10 minutes every Monday</p>
          <ol class="text-sm text-cyan-800 dark:text-cyan-200 space-y-2 list-decimal list-inside">
            <li>Check <a href={url("/metrics/lead-time-for-changes/")} class="underline">Lead Time</a> trend — any spikes?</li>
            <li>Check <a href={url("/metrics/change-failure-rate/")} class="underline">CFR</a> — any failed deployments last week?</li>
            <li>Check <a href={url("/metrics/error-budget-burn-rate/")} class="underline">Error Budget</a> burn rate — ship or freeze?</li>
            <li>Scan blocked work — any items stuck >3 days?</li>
          </ol>
        </div>
        <div class="rounded-xl border border-cyan-200 dark:border-cyan-800 bg-cyan-50 dark:bg-cyan-950/20 p-5">
          <h3 class="text-sm font-bold text-cyan-700 dark:text-cyan-300 uppercase tracking-wider mb-4">EM Monthly Review</h3>
          <p class="text-xs text-cyan-600 dark:text-cyan-400 mb-3">30 minutes at month end</p>
          <ol class="text-sm text-cyan-800 dark:text-cyan-200 space-y-2 list-decimal list-inside">
            <li>Review <a href={url("/metrics/developer-satisfaction-score/")} class="underline">DX Score</a> trend (quarterly) or proxy signals</li>
            <li>Check <a href={url("/metrics/slo-compliance-rate/")} class="underline">SLO Compliance</a> across team services</li>
            <li>Review <a href={url("/metrics/code-review-turnaround-time/")} class="underline">Code Review Turnaround</a> — bottleneck growing?</li>
            <li>Run relevant <a href={url("/metrics/diagnostics/")} class="underline">diagnostic chain</a> for any triggered metrics</li>
            <li>Prepare sprint review data using <a href={url("/metrics/language-bank/")} class="underline">calibration language</a></li>
          </ol>
        </div>
        <div class="rounded-xl border border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-950/20 p-5">
          <h3 class="text-sm font-bold text-orange-700 dark:text-orange-300 uppercase tracking-wider mb-4">Director Monthly Review</h3>
          <p class="text-xs text-orange-600 dark:text-orange-400 mb-3">45 minutes at month end</p>
          <ol class="text-sm text-orange-800 dark:text-orange-200 space-y-2 list-decimal list-inside">
            <li>Portfolio review: <a href={url("/metrics/regrettable-attrition-rate/")} class="underline">Attrition</a> + <a href={url("/metrics/slo-compliance-rate/")} class="underline">SLO</a> across all teams</li>
            <li><a href={url("/metrics/archetypes/")} class="underline">Archetype check</a> — has any team's pattern shifted?</li>
            <li>Review <a href={url("/metrics/engineering-investment-mix/")} class="underline">Investment Mix</a> against 15-20% debt target</li>
            <li>Check <a href={url("/metrics/ai-tool-adoption-trust-score/")} class="underline">AI Trust</a> and readiness trends</li>
            <li>Prepare QBR data using <a href={url("/metrics/language-bank/")} class="underline">calibration language</a></li>
          </ol>
        </div>
      </div>
    </section>

    <!-- "Why Not This Metric?" Table -->
    <section class="mb-16">
      <h2 class="section-heading">"Why Not This Metric?" Table</h2>

      <!-- Inferior Metrics -->
      <div class="mb-8">
        <h3 class="text-sm font-bold text-red-600 dark:text-red-400 uppercase tracking-wider mb-2">Inferior Metrics (Never Use as KPI)</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
          These metrics are fundamentally flawed as KPIs. Each has a better alternative that measures the same signal without the perverse incentives.
        </p>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="text-left py-3 px-4 font-semibold text-red-600 dark:text-red-400">Don't Use</th>
                <th class="text-left py-3 px-4 font-semibold text-gray-500 dark:text-gray-400">Why It's Inferior</th>
              </tr>
            </thead>
            <tbody>
              {inferiorMetrics.map(m => (
                <tr class="border-b border-gray-100 dark:border-gray-800">
                  <td class="py-3 px-4">
                    <a href={url(`/metrics/${m.slug}/`)} class="font-medium text-red-700 dark:text-red-400 hover:text-red-500 line-through decoration-1">
                      {m.name}
                    </a>
                  </td>
                  <td class="py-3 px-4 text-gray-600 dark:text-gray-400">{m.whyThisTier}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Activity Metrics -->
      <div>
        <h3 class="text-sm font-bold text-amber-600 dark:text-amber-400 uppercase tracking-wider mb-2">Activity Metrics (Diagnostic Only)</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
          These metrics have legitimate diagnostic value — use them to investigate anomalies or contextualize primary metrics.
          However, they should never be used as standalone KPIs or targets, as they measure activity rather than outcomes.
        </p>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="text-left py-3 px-4 font-semibold text-amber-600 dark:text-amber-400">Diagnostic Only</th>
                <th class="text-left py-3 px-4 font-semibold text-gray-500 dark:text-gray-400">Why Not a KPI</th>
              </tr>
            </thead>
            <tbody>
              {activityMetrics.map(m => (
                <tr class="border-b border-gray-100 dark:border-gray-800">
                  <td class="py-3 px-4">
                    <a href={url(`/metrics/${m.slug}/`)} class="font-medium text-amber-700 dark:text-amber-400 hover:text-amber-500">
                      {m.name}
                    </a>
                  </td>
                  <td class="py-3 px-4 text-gray-600 dark:text-gray-400">{m.whyThisTier}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Starter Sequences -->
    <section class="mb-16">
      <h2 class="section-heading">Starter Sequences</h2>
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
        Answer these questions in order. Stop adding metrics until each is habitual and driving decisions.
      </p>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- EM Sequence -->
        <div>
          <h3 class="text-sm font-bold text-cyan-600 dark:text-cyan-400 uppercase tracking-wider mb-4">EM Starter Sequence</h3>
          <div class="space-y-3">
            {starterSequences.em.map((step, i) => (
              <div class="rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4">
                <div class="flex items-start gap-3">
                  <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 text-xs font-bold shrink-0">
                    Q{i + 1}
                  </span>
                  <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900 dark:text-white mb-2">{step.question}</p>
                    <div class="rounded-lg bg-red-50 dark:bg-red-950/10 border border-red-200 dark:border-red-800 px-3 py-2 mb-2">
                      <span class="text-xs font-semibold text-red-600 dark:text-red-400">No → </span>
                      <span class="text-xs text-red-700 dark:text-red-300">{step.noAction}</span>
                    </div>
                    {step.yesNext ? (
                      <div class="text-xs text-green-600 dark:text-green-400 font-medium">Yes → Continue to next question ↓</div>
                    ) : (
                      <div class="rounded-lg bg-green-50 dark:bg-green-950/10 border border-green-200 dark:border-green-800 px-3 py-2">
                        <span class="text-xs font-semibold text-green-600 dark:text-green-400">Yes → </span>
                        <span class="text-xs text-green-700 dark:text-green-300">You have the Top 3. Add CFR and Sprint Commitment Accuracy. STOP adding metrics until these are habitual.</span>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
        <!-- Director Sequence -->
        <div>
          <h3 class="text-sm font-bold text-orange-600 dark:text-orange-400 uppercase tracking-wider mb-4">Director Starter Sequence</h3>
          <div class="space-y-3">
            {starterSequences.director.map((step, i) => (
              <div class="rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4">
                <div class="flex items-start gap-3">
                  <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 text-xs font-bold shrink-0">
                    Q{i + 1}
                  </span>
                  <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900 dark:text-white mb-2">{step.question}</p>
                    <div class="rounded-lg bg-red-50 dark:bg-red-950/10 border border-red-200 dark:border-red-800 px-3 py-2 mb-2">
                      <span class="text-xs font-semibold text-red-600 dark:text-red-400">No → </span>
                      <span class="text-xs text-red-700 dark:text-red-300">{step.noAction}</span>
                    </div>
                    {step.yesNext ? (
                      <div class="text-xs text-green-600 dark:text-green-400 font-medium">Yes → Continue to next question ↓</div>
                    ) : (
                      <div class="rounded-lg bg-green-50 dark:bg-green-950/10 border border-green-200 dark:border-green-800 px-3 py-2">
                        <span class="text-xs font-semibold text-green-600 dark:text-green-400">Yes → </span>
                        <span class="text-xs text-green-700 dark:text-green-300">You have the Top 3. Add DX trends, DORA benchmarks, and AI readiness. STOP adding until these inform real decisions.</span>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- 5-Question Metric Addition Test -->
    <section class="mb-16">
      <h2 class="section-heading">5-Question Metric Addition Test</h2>
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
        Before adding any metric, answer all five. If any answer is "no," don't track it.
      </p>
      <div class="space-y-3">
        {decisionTest.map((question, i) => (
          <div class="flex items-start gap-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 text-sm font-bold shrink-0">
              {i + 1}
            </span>
            <div>
              <p class="text-sm font-medium text-gray-900 dark:text-white">{question}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                {i === 0 && "If none, it's decoration."}
                {i === 1 && "If not, it will create perverse incentives."}
                {i === 2 && "If yes, ban it from targets and performance evaluation."}
                {i === 3 && "If individual, aggregate to team level or stop."}
                {i === 4 && "If yes, this is a drill-down, not a headline."}
              </p>
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- Decision Tree -->
    <section class="mb-16">
      <h2 class="section-heading">Metric Decision Tree</h2>
      <div class="rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6 overflow-x-auto">
        <div class="min-w-[700px]">
          <div class="flex flex-col items-center">
            <div class="px-6 py-3 rounded-lg bg-blue-100 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-700 text-sm font-semibold text-blue-800 dark:text-blue-200 text-center">
              What are you trying to measure?
            </div>
            <div class="w-px h-6 bg-gray-300 dark:bg-gray-600"></div>
            <div class="grid grid-cols-5 gap-3 w-full">
              <!-- Delivery -->
              <div class="flex flex-col items-center">
                <div class="px-3 py-2 rounded-lg bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 text-xs font-medium text-green-700 dark:text-green-300 text-center w-full">
                  Delivery Speed & Quality
                </div>
                <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                <div class="space-y-2 w-full">
                  <a href={url("/metrics/lead-time-for-changes/")} class="block px-3 py-2 rounded-lg bg-amber-50 dark:bg-amber-950/10 border border-amber-200 dark:border-amber-800 text-xs text-amber-800 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/20 transition-colors">
                    <strong>Lead Time</strong> + <strong>CFR</strong>
                  </a>
                  <a href={url("/metrics/sprint-commitment-accuracy/")} class="block px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    Sprint Commitment
                  </a>
                </div>
              </div>
              <!-- Reliability -->
              <div class="flex flex-col items-center">
                <div class="px-3 py-2 rounded-lg bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 text-xs font-medium text-red-700 dark:text-red-300 text-center w-full">
                  Reliability & Incidents
                </div>
                <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                <div class="space-y-2 w-full">
                  <a href={url("/metrics/error-budget-burn-rate/")} class="block px-3 py-2 rounded-lg bg-amber-50 dark:bg-amber-950/10 border border-amber-200 dark:border-amber-800 text-xs text-amber-800 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/20 transition-colors">
                    <strong>Error Budget</strong> + <strong>Actions</strong>
                  </a>
                  <a href={url("/metrics/slo-compliance-rate/")} class="block px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    SLO Compliance
                  </a>
                </div>
              </div>
              <!-- People -->
              <div class="flex flex-col items-center">
                <div class="px-3 py-2 rounded-lg bg-purple-50 dark:bg-purple-950/20 border border-purple-200 dark:border-purple-800 text-xs font-medium text-purple-700 dark:text-purple-300 text-center w-full">
                  Team Health & Retention
                </div>
                <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                <div class="space-y-2 w-full">
                  <a href={url("/metrics/developer-satisfaction-score/")} class="block px-3 py-2 rounded-lg bg-amber-50 dark:bg-amber-950/10 border border-amber-200 dark:border-amber-800 text-xs text-amber-800 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/20 transition-colors">
                    <strong>DX Score</strong> + <strong>Attrition</strong>
                  </a>
                  <a href={url("/metrics/burnout-risk-index/")} class="block px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    Burnout Risk Index
                  </a>
                </div>
              </div>
              <!-- Strategy -->
              <div class="flex flex-col items-center">
                <div class="px-3 py-2 rounded-lg bg-indigo-50 dark:bg-indigo-950/20 border border-indigo-200 dark:border-indigo-800 text-xs font-medium text-indigo-700 dark:text-indigo-300 text-center w-full">
                  Strategy & Business
                </div>
                <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                <div class="space-y-2 w-full">
                  <a href={url("/metrics/engineering-investment-mix/")} class="block px-3 py-2 rounded-lg bg-amber-50 dark:bg-amber-950/10 border border-amber-200 dark:border-amber-800 text-xs text-amber-800 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/20 transition-colors">
                    <strong>Investment Mix</strong> + <strong>Attribution</strong>
                  </a>
                  <a href={url("/metrics/economics/")} class="block px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    Tech Debt Economics
                  </a>
                </div>
              </div>
              <!-- AI Integration -->
              <div class="flex flex-col items-center">
                <div class="px-3 py-2 rounded-lg bg-violet-50 dark:bg-violet-950/20 border border-violet-200 dark:border-violet-800 text-xs font-medium text-violet-700 dark:text-violet-300 text-center w-full">
                  AI Integration
                </div>
                <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                <div class="space-y-2 w-full">
                  <a href={url("/metrics/ai-assisted-pr-ratio/")} class="block px-3 py-2 rounded-lg bg-amber-50 dark:bg-amber-950/10 border border-amber-200 dark:border-amber-800 text-xs text-amber-800 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/20 transition-colors">
                    <strong>AI PR Ratio</strong> + <strong>Verification</strong>
                  </a>
                  <a href={url("/metrics/ai-tool-adoption-trust-score/")} class="block px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    AI Trust Score
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>
</BaseLayout>

<script>
  const tabs = document.querySelectorAll('.stack-tab');
  const panels = document.querySelectorAll('.stack-panel');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const target = (tab as HTMLElement).dataset.tab;
      tabs.forEach(t => {
        t.classList.remove('active', 'bg-blue-50', 'text-blue-700', 'dark:bg-blue-900/30', 'dark:text-blue-300');
        t.classList.add('text-gray-500', 'hover:bg-gray-100', 'dark:text-gray-400', 'dark:hover:bg-gray-800');
      });
      tab.classList.add('active', 'bg-blue-50', 'text-blue-700', 'dark:bg-blue-900/30', 'dark:text-blue-300');
      tab.classList.remove('text-gray-500', 'hover:bg-gray-100', 'dark:text-gray-400', 'dark:hover:bg-gray-800');

      panels.forEach(panel => {
        if ((panel as HTMLElement).id === `stack-${target}`) {
          panel.classList.remove('hidden');
        } else {
          panel.classList.add('hidden');
        }
      });
    });
  });
</script>

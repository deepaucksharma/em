---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import TierBadge from '../../components/ui/TierBadge.astro';
import { archetypes, getMetric, diagnosticChains, metricsRoadmap, getRecommendedMetricsForArchetype } from '../../lib/data';
import { getSeverityColors } from '../../lib/metrics-colors';
---

<BaseLayout title="Metrics by Archetype" description="Recommended metrics, dashboards, and diagnostic chains tailored to each organizational archetype.">
  <!-- Hero -->
  <section class="relative bg-gradient-to-br from-amber-50 via-orange-50/50 to-white dark:from-gray-800 dark:via-slate-800 dark:to-gray-900 border-b border-gray-200 dark:border-gray-800 overflow-hidden">
    <div class="hero-pattern absolute inset-0 pointer-events-none"></div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
      <div class="max-w-3xl">
        <Breadcrumb items={[
          { label: 'Metrics', href: '/metrics/' },
          { label: 'By Archetype' },
        ]} />
        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-4">
          Metrics by Archetype
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-400 mb-2">
          Tailored metric recommendations for your team's reality
        </p>
        <p class="text-lg text-gray-500 dark:text-gray-400 mb-8">
          Each archetype has different metrics priorities, dashboard configurations, and diagnostic chains.
          Find your archetype and get a customized starting point.
        </p>
        <div class="flex flex-wrap gap-3">
          <a href="/metrics/getting-started/" class="inline-flex items-center px-5 py-2.5 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            Not sure which archetype? Take the quiz
          </a>
        </div>
      </div>
    </div>
  </section>

  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Quick nav -->
    <section class="mb-12">
      <div class="flex flex-wrap gap-2">
        {archetypes.map(arch => {
          const colors = getSeverityColors(arch.id);
          return (
            <a href={`#${arch.slug}`} class:list={['inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-medium border transition-colors hover:bg-gray-50 dark:hover:bg-gray-800', colors.bg]}>
              <span class:list={['w-2 h-2 rounded-full', colors.bar]}></span>
              <span class="text-gray-700 dark:text-gray-300">{arch.id}: {arch.name}</span>
            </a>
          );
        })}
      </div>
    </section>

    <!-- Archetype sections -->
    {archetypes.map(arch => {
      const colors = getSeverityColors(arch.id);
      const recommended = getRecommendedMetricsForArchetype(arch.id);
      const relevantChains = diagnosticChains.filter(dc =>
        arch.diagnosticMetricIds.includes(dc.triggerMetricId)
      );

      return (
        <section id={arch.slug} class="mb-16 scroll-mt-20">
          <div class:list={['rounded-xl border overflow-hidden bg-white dark:bg-gray-800', colors.bg]}>
            <div class:list={['h-1.5', colors.bar]} role="presentation"></div>
            <div class="p-6 md:p-8">
              <!-- Header -->
              <div class="flex items-center gap-3 mb-2">
                <span class="text-sm font-mono font-bold text-gray-400 dark:text-gray-500">{arch.id}</span>
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">{arch.name}</h2>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">{arch.signaturePattern}</p>

              {/* Quantified Thresholds */}
              {arch.quantifiedThresholds && (
                <div class="mb-6">
                  <h3 class="text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-3">Diagnostic Thresholds</h3>
                  <div class="flex flex-wrap gap-2">
                    {Object.entries(arch.quantifiedThresholds).map(([key, value]) => (
                      <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-gray-100 dark:bg-gray-700 text-xs">
                        <span class="font-medium text-gray-500 dark:text-gray-400">{key.replace(/([A-Z])/g, ' $1').trim()}:</span>
                        <span class="font-semibold text-gray-800 dark:text-gray-200">{value}</span>
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {/* Recommended Metrics */}
              {recommended.length > 0 && (
                <div class="mb-6">
                  <h3 class="text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-3">Recommended Metrics</h3>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                    {recommended.map((m, i) => (
                      <a href={`/metrics/${m.slug}/`} class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2 hover:border-amber-300 dark:hover:border-amber-700 transition-colors">
                        <span class:list={['inline-flex items-center justify-center w-5 h-5 rounded-full text-[10px] font-bold', i < 3 ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300' : 'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400']}>
                          {i + 1}
                        </span>
                        <div class="flex-1 min-w-0">
                          <span class="text-sm font-medium text-gray-900 dark:text-white truncate block">{m.name}</span>
                          <span class="text-xs text-gray-500 dark:text-gray-400">{m.id} &middot; {m.category}</span>
                        </div>
                        <TierBadge tier={m.tier} size="sm" />
                      </a>
                    ))}
                  </div>
                </div>
              )}

              {/* Dashboard Notes */}
              <div class="mb-6">
                <h3 class="text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2">Dashboard Customization</h3>
                <p class="text-sm text-gray-700 dark:text-gray-300">
                  <strong>Priority:</strong> {arch.firstPriority}
                </p>
              </div>

              {/* Relevant Diagnostic Chains */}
              {relevantChains.length > 0 && (
                <div class="mb-4">
                  <h3 class="text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2">Diagnostic Chains to Watch</h3>
                  <div class="flex flex-wrap gap-2">
                    {relevantChains.map(dc => (
                      <a href={`/metrics/diagnostics/#${dc.slug}`} class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 text-xs font-medium text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">
                        {dc.id}: {dc.triggerCondition}
                      </a>
                    ))}
                  </div>
                </div>
              )}

              {/* Anti-pattern warning */}
              <div class="rounded-lg bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 p-3 mt-4">
                <h4 class="text-xs font-semibold text-amber-700 dark:text-amber-400 mb-1">Anti-Pattern If Ignored</h4>
                <p class="text-sm text-amber-800 dark:text-amber-300">{arch.antiPatternIfIgnored}</p>
              </div>
            </div>
          </div>
        </section>
      );
    })}

    <!-- CTA -->
    <section class="rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-6 text-center">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Set up your metrics program</h3>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        Follow the getting started guide to go from archetype identification to habitual measurement in 90 days.
      </p>
      <div class="flex flex-wrap justify-center gap-3">
        <a href="/metrics/getting-started/" class="inline-flex items-center gap-2 px-5 py-2.5 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors">
          Getting Started Guide
        </a>
        <a href="/metrics/dashboards/" class="inline-flex items-center gap-2 px-5 py-2.5 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          Dashboard Blueprints
        </a>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .hero-pattern {
    background-image: radial-gradient(circle, #f59e0b20 1px, transparent 1px);
    background-size: 24px 24px;
  }
  :global(.dark) .hero-pattern {
    background-image: radial-gradient(circle, #f59e0b10 1px, transparent 1px);
  }
</style>

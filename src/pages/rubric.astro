---
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumb from '../components/ui/Breadcrumb.astro';
import Badge from '../components/ui/Badge.astro';
import { rubricAnchors, capabilities, getCapability } from '../lib/data';
import { getDomainColor } from '../lib/utils';

// Group rubric anchors by capability
const rubricByCapability = capabilities.map(cap => ({
  capability: cap,
  anchors: rubricAnchors.filter(r => r.capabilityId === cap.id),
})).filter(g => g.anchors.length > 0);
---

<BaseLayout title="Rubric" description="Full rubric overview with 3-level behavioral anchors for all 14 capabilities.">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <Breadcrumb items={[{ label: 'Rubric' }]} />

    <div class="mb-8">
      <h1 class="text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-2">Rubric Overview</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        {rubricAnchors.length} behavioral anchors across 3 levels — Developing, Competent, and Advanced — for self-assessment and calibration.
      </p>
    </div>

    <div class="space-y-8">
      {rubricByCapability.map(({ capability: cap, anchors }) => (
        <section class="border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden">
          <div class:list={['px-6 py-4 border-b border-gray-200 dark:border-gray-700', getDomainColor(cap.domain).bg]}>
            <div class="flex items-center gap-3">
              <Badge text={cap.domain} variant="domain" domain={cap.domain} />
              <a href={`/capabilities/${cap.slug}/`} class="text-lg font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400">
                {cap.id}: {cap.name}
              </a>
            </div>
          </div>

          {anchors.map((anchor, i) => (
            <div class:list={['px-6 py-5', i > 0 && 'border-t border-gray-100 dark:border-gray-800']}>
              {anchors.length > 1 && (
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-3">{anchor.sourceTopic}</p>
              )}
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4">
                  <h4 class="text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2">Developing</h4>
                  <p class="text-sm text-gray-700 dark:text-gray-300">{anchor.level1Developing}</p>
                </div>
                <div class="bg-blue-50 dark:bg-blue-950/20 rounded-lg p-4">
                  <h4 class="text-xs font-semibold uppercase tracking-wider text-blue-600 dark:text-blue-400 mb-2">Competent</h4>
                  <p class="text-sm text-blue-800 dark:text-blue-300">{anchor.level3Competent}</p>
                </div>
                <div class="bg-green-50 dark:bg-green-950/20 rounded-lg p-4">
                  <h4 class="text-xs font-semibold uppercase tracking-wider text-green-600 dark:text-green-400 mb-2">Advanced</h4>
                  <p class="text-sm text-green-800 dark:text-green-300">{anchor.level5Advanced}</p>
                </div>
              </div>
            </div>
          ))}
        </section>
      ))}
    </div>
  </div>
</BaseLayout>

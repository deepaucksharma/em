---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import CapabilityCard from '../../components/cards/CapabilityCard.astro';
import { capabilities } from '../../lib/data';
import { DOMAIN_ORDER, getDomainColor } from '../../lib/utils';
import { url } from '../../lib/url';

const capsByDomain = DOMAIN_ORDER.map(domain => ({
  domain,
  capabilities: capabilities.filter(c => c.domain === domain),
}));
---

<BaseLayout title="Capabilities" description="All 14 engineering leadership capabilities organized by domain.">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <Breadcrumb items={[{ label: 'Capabilities' }]} />

    <div class="mb-8">
      <h1 class="text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-2">Capabilities</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        {capabilities.length} capabilities across {DOMAIN_ORDER.length} domains â€” the building blocks of engineering leadership.
      </p>
      <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
        Each capability defines a distinct competency area that engineering managers and directors are expected to develop.
        Capabilities are grouped into domains and assessed through observable behaviors, rubric anchors, and calibration signals.
        Use the <a href={url("/self-assessment/")} class="text-blue-600 dark:text-blue-400 hover:underline">self-assessment tool</a> to
        rate yourself, or explore the <a href={url("/rubric/")} class="text-blue-600 dark:text-blue-400 hover:underline">rubric</a> for
        detailed behavioral descriptions at each level.
      </p>
    </div>

    {capsByDomain.map(({ domain, capabilities: caps }) => (
      <section class="mb-10">
        <div class="flex items-center gap-3 mb-4">
          <h2 class:list={['text-xl font-bold', getDomainColor(domain).text]}>{domain}</h2>
          <span class="text-sm text-gray-500 dark:text-gray-400">{caps.length} capabilities</span>
          <a href={url(`/domains/${domain.toLowerCase()}/`)} class="text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 ml-auto">
            View domain &rarr;
          </a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {caps.map(cap => (
            <CapabilityCard capability={cap} />
          ))}
        </div>
      </section>
    ))}
  </div>
</BaseLayout>

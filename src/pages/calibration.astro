---
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumb from '../components/ui/Breadcrumb.astro';
import Badge from '../components/ui/Badge.astro';
import { calibrationSignals, capabilities, getCapability } from '../lib/data';
import { getDomainColor } from '../lib/utils';

const signalTypes = [...new Set(calibrationSignals.map(s => s.signalType))].sort();

// Group by capability
const signalsByCapability = capabilities.map(cap => ({
  capability: cap,
  signals: calibrationSignals.filter(s => s.capabilityId === cap.id),
})).filter(g => g.signals.length > 0);
---

<BaseLayout title="Calibration Signals" description="138 calibration signals for promo packets, reviews, and career conversations.">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <Breadcrumb items={[{ label: 'Calibration Signals' }]} />

    <div class="mb-8">
      <h1 class="text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-2">Calibration Signals</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        {calibrationSignals.length} signals across {signalTypes.length} types — language and evidence for promo packets, calibration sessions, and performance reviews.
      </p>
    </div>

    <!-- Signal type legend -->
    <div class="flex flex-wrap gap-2 mb-8">
      {signalTypes.map(type => (
        <span class="badge bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300">{type}</span>
      ))}
    </div>

    <div class="space-y-8">
      {signalsByCapability.map(({ capability: cap, signals }) => (
        <section class="border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden">
          <div class:list={['px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between', getDomainColor(cap.domain).bg]}>
            <div class="flex items-center gap-3">
              <Badge text={cap.domain} variant="domain" domain={cap.domain} />
              <a href={`/capabilities/${cap.slug}/`} class="font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400">
                {cap.id}: {cap.name}
              </a>
            </div>
            <span class="text-sm text-gray-500 dark:text-gray-400">{signals.length} signals</span>
          </div>

          <div class="divide-y divide-gray-100 dark:divide-gray-800">
            {signals.map(sig => (
              <div class="px-6 py-3 flex items-start gap-3">
                <span class="badge bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 shrink-0 mt-0.5">{sig.signalType}</span>
                <div class="flex-1 min-w-0">
                  <p class="text-sm text-gray-700 dark:text-gray-300">{sig.signalText}</p>
                  <p class="text-xs text-gray-400 dark:text-gray-500 mt-0.5 font-mono">{sig.id} · {sig.observableId}</p>
                </div>
              </div>
            ))}
          </div>
        </section>
      ))}
    </div>
  </div>
</BaseLayout>
